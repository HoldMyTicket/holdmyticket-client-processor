!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("axios")):"function"==typeof define&&define.amd?define(["axios"],t):"object"==typeof exports?exports.hmt_client_processor=t(require("axios")):e.hmt_client_processor=t(e.axios)}(window,function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(t,r){t.exports=e},function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n);t.default=function(e){var t=this;this.url=function(e,t){return this.api_url+e+(t?this.api_url_suffix:"")},this.spreedly_url=function(e){return"https://core.spreedly.com/v1/payment_methods.json?environment_key="+e},this.fullsteam_url=function(){return"https://api"+("local"==this.env||"dev"==this.env||"staging"==this.env?"-ext":"")+".fullsteampay.net/"},this.submit_transaction=function(e,t,r){this._remove_card_data(),"spreedly"==t.processor_method?this._submit_spreedly(e,t,r):"fullsteam"==t.processor_method?this._submit_fullsteam(e,t,r):this._throw_error(!0,{status:"error",msg:"No processing method setup"},r)},this._submit_spreedly=function(e,r,n){r.payment_token?t._submit_spreedly_transaction(r,function(e,a){r.cb_data&&(a.cb_data=r.cb_data),t._respond(e,a,n)}):t._get_spreedly_token(e,r.spreedly_environment_key,function(e,a){if(e)return r.cb_data&&(a.cb_data=r.cb_data),void t._respond(e,a,n);r.payment_token=a.transaction.payment_method.token,r.payments&&(r.payments=t._update_payments_token(r.payments,r.payment_token)),t._submit_spreedly_transaction(r,function(e,a){r.cb_data&&(a.cb_data=r.cb_data),!e&&a.ticket_key&&t._save_card_to_webuser({ticket_key:a.ticket_key}),t._respond(e,a,n)})}),r.cc_retain&&"y"==r.cc_retain&&t.save_card(e,r,"fullsteam")},this._update_payments_token=function(e,t){for(var r=0;r<e.length;r++)"credit"==e[r].type&&(e[r].payment_token=t);return e},this._get_spreedly_token=function(e,r,n){t._request({url:t.spreedly_url(r),type:"POST",withCredentials:!1,data:e,cb:function(e,r){t._respond(e,r,n)}})},this._submit_spreedly_transaction=function(e,r){t._request({url:t.url("shop/carts/submit",!0),type:"POST",data:e,form_encoded:!0,withCredentials:!0,cb:function(e,n){t._respond(e,n,r)}})},this._submit_fullsteam=function(e,r,n){r.payment_token?t._submit_fullsteam_transaction(r,function(e,a){r.cb_data&&(a.cb_data=r.cb_data),t._respond(e,a,n)}):t._get_fullsteam_auth_key(function(a,s){var o=null;s&&s.status&&"ok"==s.status&&s.authenticationKey&&(o=s.authenticationKey),t._get_fullsteam_token(e,r,o,function(e,a){if(!a||!a.isSuccessful||!a.token)return r.cb_data&&(a.cb_data=r.cb_data),t._handle_fullsteam_error(a,n);r.payment_token=a.token,r.payments&&(r.payments=t._update_payments_token(r.payments,r.payment_token)),t._submit_fullsteam_transaction(r,function(e,a){r.cb_data&&(a.cb_data=r.cb_data),!e&&a.ticket_key&&t._save_card_to_webuser({ticket_key:a.ticket_key}),t._respond(e,a,n)})})}),r.cc_retain&&"y"==r.cc_retain&&(r.spreedly_environment_key||(r.spreedly_environment_key=t._get_spreedly_env_key()),t.save_card(e,r,"spreedly"))},this._get_spreedly_env_key=function(){return this.spreedly_environment_key?this.spreedly_environment_key:config&&config.spreedly_environment_key?config.spreedly_environment_key:""},this.save_card=function(e,r,n,a){if(e&&e.payment_method&&e.payment_method.credit_card){var s={card:e.payment_method.credit_card,processor:n};(a=a||"")&&(s.ticket_key=a),"spreedly"==n&&t._get_spreedly_token(e,r.spreedly_environment_key,function(e,r){e||(r.transaction&&r.transaction.payment_method&&r.transaction.payment_method.token&&(s.token=r.transaction.payment_method.token),t._save_card_to_webuser(s))}),"fullsteam"==n&&t._get_fullsteam_auth_key(function(n,a){var o=null;a&&a.status&&"ok"==a.status&&a.authenticationKey&&(o=a.authenticationKey),o&&t._get_fullsteam_token(e,r,o,function(e,r){r&&r.isSuccessful&&r.token&&(s.token=r.token,t._save_card_to_webuser(s))})})}},this.webuser_save_card=function(e,r,n,a){t._get_spreedly_token(e,r.spreedly_environment_key,function(s,o){if(s)t._respond(s,o,a);else{var i={webuser_id:n,token:o.transaction.payment_method.token,vault:"spreedly"};t._request({url:t.url("public/users/save_credit_card",!1),type:"POST",withCredentials:!1,data:i,form_encoded:!0,cb:function(s,o){if(o&&"200"==o.status&&"OK"==o.statusText&&(o=o.data),!o||!o.status||"ok"!=o.status)return t._respond(s,o,a);t._get_fullsteam_auth_key(function(s,o){var i=null;o&&o.status&&"ok"==o.status&&o.authenticationKey&&(i=o.authenticationKey),i&&(!r.zip&&e.payment_method.credit_card.zip&&(r.zip=e.payment_method.credit_card.zip),t._get_fullsteam_token(e,r,i,function(r,s){if(!s||!s.isSuccessful||!s.token)return t._respond(r,s,a);var o=e.payment_method.credit_card?t._format_card_for_save(e.payment_method.credit_card):null,i={webuser_id:n,vault:"fullsteam",token:s.token,card_data:o};t._request({url:t.url("public/users/save_additional_card",!1),type:"POST",withCredentials:!1,data:i,form_encoded:!0,cb:function(e,r){t._respond(e,r,a)}})}))})}})}})},this._save_card_to_webuser=function(e){t._remember_card_data(e);var r=t.card_data?t._format_card_for_save(t.card_data):null;if(t.card_ticket_key&&r&&t.card_token&&t.card_processor){var n={ticket_key:t.card_ticket_key,vault:t.card_processor,token:t.card_token,card_data:r};t._request({url:t.url("public/orders/save_additional_card",!1),type:"POST",withCredentials:!1,data:n,form_encoded:!0,cb:function(e,t){}})}},this._format_card_for_save=function(e){return!!e.full_name&&!!e.month&&!!e.year&&!!e.number&&{full_name:e.full_name,last_four:t._get_last_four(e.number),exp_month:e.month,exp_year:e.year}},this._get_last_four=function(e){return e.substr(e.length-4)},this._remember_card_data=function(e){e.card&&(t.card_data=e.card),e.token&&(t.card_token=e.token),e.processor&&(t.card_processor=e.processor),e.ticket_key&&(t.card_ticket_key=e.ticket_key)},this._remove_card_data=function(){delete t.card_data,delete t.card_token,delete t.processor,delete t.card_ticket_key},this._get_fullsteam_auth_key=function(e){t._request({url:this.url("shop/processors/get_authentication_key",!0),cb:function(r,n){t._respond(r,n,e)}})},this._get_fullsteam_token=function(e,r,n,a){if(e&&e.payment_method&&e.payment_method.credit_card&&e.payment_method.credit_card.number&&e.payment_method.credit_card.month&&e.payment_method.credit_card.year&&e.payment_method.credit_card.full_name&&e.payment_method.credit_card.verification_value){var s={clearTextCardData:{cardNumber:e.payment_method.credit_card.number.replace(/\s/g,""),cvv:e.payment_method.credit_card.verification_value,expirationMonth:e.payment_method.credit_card.month,expirationYear:e.payment_method.credit_card.year,billingInformation:{nameOnAccount:e.payment_method.credit_card.full_name,firstName:r.f_name||null,lastName:r.l_name||null,address1:r.address1||null,address2:r.address2||null,city:r.city||null,state:r.state||null,zip:r.zip||null,phone:r.phone||null,email:r.email||null}},cardEntryContext:"box"==this.app_type?1:5,performAccountVerification:!0};t._request({url:this.fullsteam_url()+"api/token/card/clearText/create",type:"POST",cors:!0,crossdomain:!0,data:s,json:!0,withCredentials:!1,auth_key:n,cb:function(e,r){t._respond(e,r,a)}})}else a(!0,"Missing required card inputs")},this._submit_fullsteam_transaction=function(e,r){t._request({url:this.url("shop/carts/submit",!0),type:"POST",data:e,form_encoded:!0,withCredentials:!0,cb:function(e,n){t._respond(e,n,r)}})},this._request=function(e){var r={};e.json&&(r["content-type"]="application/json;charset=UTF-8"),e.form_encoded&&(r["content-type"]="application/x-www-form-urlencoded;charset=UTF-8",e.data=t._serialize(e.data)),e.auth_key&&(r.authenticationKey=e.auth_key),a()({method:e.type||"GET",url:e.url,mode:"no-cors",credentials:"same-origin",headers:r,withCredentials:e.withCredentials||!1,crossdomain:e.crossdomain||!1,data:e.data}).then(function(r){t.isHmtMobile&&200==r.status&&!r.statusText&&(r.statusText="OK"),e.cb&&e.cb(null,r)}).catch(function(r,n){var a=t._format_error(r,e.url);n||(n={}),n.status||"error"===n.status||(n.status="error"),n.msg=a,e.cb&&e.cb(r,n)})},this._format_error=function(e,t){return-1!=t.indexOf("core.spreedly.com")?this._format_spreedly_error(e):this._format_fullsteam_error(e)},this._format_spreedly_error=function(e){if(e.response&&e.response.data&&e.response.data.errors){for(var t="Processing Error:<br>",r=0;r<e.response.data.errors.length;r++){var n=e.response.data.errors[r];t+=n.message?"- "+n.message+"<br>":""}return t}return"Unkown error"},this._format_fullsteam_error=function(e){return e&&e.msg?e.msg:"Unkown error"},this._handle_fullsteam_error=function(e,r){var n="";if(e&&e.responseDetails)for(key in e.responseDetails)n+=e.responseDetails[key].message+"\n\n";if(e&&e.issuerResponseDetails){var a=e.issuerResponseDetails.issuerResponseCode||0,s=e.issuerResponseDetails.issuerResponseDescription||"",o=e.issuerResponseDetails.cvvResponseCode&&-1==["M","P"].indexOf(e.issuerResponseDetails.cvvResponseCode)&&e.issuerResponseDetails.cvvResponseCode&&e.issuerResponseDetails.cvvResponseDescription?e.issuerResponseDetails.cvvResponseDescription:"";o?n="CVV Error: "+o:(""==n&&s&&(n="Error: "+s),""!=n||a&&"00"!=a||(n="CPE2: Missing error code"),""==n&&(n="CPE3: Unkown issuer error"))}return n=n||"CPE4: Unknown processor error",e.msg=n,t._throw_error(!0,e,r)},this._respond=function(e,r,n){!e&&r&&"error"!=r.status?n&&(r.data?n(null,r.data):n(null,r)):t._throw_error(e,r,n)},this._throw_error=function(e,t,r){!e&&t.msg&&(e=t.msg),e||(e=!0),r&&r(e,t)},this._serialize=function(e,r){var n,a=[];for(n in e)if(e.hasOwnProperty(n)){var s=r?r+"["+n+"]":n,o=e[n];a.push(null!==o&&"object"==typeof o?t._serialize(o,s):encodeURIComponent(s)+"="+encodeURIComponent(o))}return a.join("&")},this.api_url=e.api_url||"",this.api_url_suffix=e.api_url_suffix||"",this.env=e.env||"",this.app_type=e.app_type||"",this.isHmtMobile=e.isHmtMobile||!1}}]).default});